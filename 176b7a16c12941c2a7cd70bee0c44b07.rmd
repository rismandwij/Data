---
jupyter:
  colab:
  gpuClass: standard
  kernelspec:
    display_name: R
    language: R
    name: ir
  language_info:
    codemirror_mode: r
    file_extension: .r
    mimetype: text/x-r-source
    name: R
    pygments_lexer: r
    version: 4.0.5
  nbformat: 4
  nbformat_minor: 4
---

::: {.cell .markdown}
# Tugas Akhir Sesi UTS

Kelompok 2 Statistika Machine Learning

Oleh :

-   Siti Hasanah (G1501221014)
-   Megawati (G1501221026)
-   L.M. Risman Dwi Jumansyah (G1501222058)

Dalam tugas akhir kami mengerjakan project tentang prediksi harga
penginapan. Dimana untuk memprediksi harga kita menggunakan model
regresi linear, Ridge, LASSO, Elastic NET, Regression Tree, Bagging dan
Random Forest.
:::

::: {.cell .markdown}
## Preparation

### Packages
:::

::: {.cell .code execution_count="4" colab="{\"base_uri\":\"https://localhost:8080/\"}" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:42.594507Z\",\"iopub.status.busy\":\"2023-03-12T21:51:42.593090Z\",\"iopub.status.idle\":\"2023-03-12T21:51:42.627705Z\"}" id="YKllXfASFc0T" outputId="b356f8c8-13a2-44d2-9d9a-12d6bf4c2c15" trusted="true"}
``` R
library(tidyverse)
library(lubridate)
library(ipred)
library(glmnet)
library(ranger)
library(caret)
library(rpart)
library(rpart.plot)
library(ipred)
library(corrplot)
library(ggplot2)
library(scales)
library(GGally)
library(hrbrthemes)
library(viridis)
```
:::

::: {.cell .markdown}
### Import Data
:::

::: {.cell .code execution_count="5" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":306}" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:42.634283Z\",\"iopub.status.busy\":\"2023-03-12T21:51:42.633071Z\",\"iopub.status.idle\":\"2023-03-12T21:51:44.638483Z\"}" id="uivv_LbTGA_8" outputId="6bbf146c-d268-4bad-d05e-c4ed02760b7e" trusted="true"}
``` R
data_train<-read.csv("/kaggle/input/sta1582-sesi-uts-genap-2023/train.csv")
data_train<-data_train %>% 
  select(id,accommodates,bathrooms,host_since,host_response_rate,cancellation_policy,cleaning_fee,
  first_review,last_review,host_has_profile_pic,host_identity_verified,latitude,longitude,number_of_reviews,
  review_scores_rating,bedrooms,beds,instant_bookable,bed_type,price)
head(data_train)
```

::: {.output .display_data}

A data.frame: 6 × 20

| <!--/--> | id &lt;int&gt; | accommodates &lt;int&gt; | bathrooms &lt;dbl&gt; | host_since &lt;chr&gt; | host_response_rate &lt;chr&gt; | cancellation_policy &lt;chr&gt; | cleaning_fee &lt;chr&gt; | first_review &lt;chr&gt; | last_review &lt;chr&gt; | host_has_profile_pic &lt;chr&gt; | host_identity_verified &lt;chr&gt; | latitude &lt;dbl&gt; | longitude &lt;dbl&gt; | number_of_reviews &lt;int&gt; | review_scores_rating &lt;int&gt; | bedrooms &lt;int&gt; | beds &lt;int&gt; | instant_bookable &lt;chr&gt; | bed_type &lt;chr&gt; | price &lt;dbl&gt; |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1 |  6901257 | 3 | 1 | 2012-03-26 | <!----> | strict   | True | 2016-06-18 | 2016-07-18 | t | t | 40.69652 |  -73.99162 |  2 | 100 | 1 | 1 | f | Real Bed | 150 |
| 2 |  6304928 | 7 | 1 | 2017-06-19 | 100% | strict   | True | 2017-08-05 | 2017-09-23 | t | f | 40.76612 |  -73.98904 |  6 |  93 | 3 | 3 | t | Real Bed | 169 |
| 3 |  7919400 | 5 | 1 | 2016-10-25 | 100% | moderate | True | 2017-04-30 | 2017-09-14 | t | t | 40.80811 |  -73.94376 | 10 |  92 | 1 | 3 | t | Real Bed | 145 |
| 4 | 13418779 | 4 | 1 | 2015-04-19 | <!----> | flexible | True | <!----> | <!----> | t | t | 37.77200 | -122.43162 |  0 |  NA | 2 | 2 | f | Real Bed | 750 |
| 5 |  3808709 | 2 | 1 | 2015-03-01 | 100% | moderate | True | 2015-05-12 | 2017-01-22 | t | t | 38.92563 |  -77.03460 |  4 |  40 | 0 | 1 | t | Real Bed | 115 |
| 6 | 12422935 | 2 | 1 | 2017-06-07 | 100% | strict   | True | 2017-08-27 | 2017-09-05 | t | t | 37.75316 | -122.42953 |  3 | 100 | 1 | 1 | t | Real Bed |  85 |
:::
:::

::: {.cell .code execution_count="6" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":306}" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:44.644101Z\",\"iopub.status.busy\":\"2023-03-12T21:51:44.642149Z\",\"iopub.status.idle\":\"2023-03-12T21:51:45.405543Z\"}" id="l89MdskcJA7H" outputId="8ac171d1-27ec-4629-dbe6-6171e0d11d0c" trusted="true"}
``` R
data_test<-read.csv("/kaggle/input/sta1582-sesi-uts-genap-2023/test.csv")
data_test<-data_test %>% 
  select(id,accommodates,bathrooms,host_since,host_response_rate,cancellation_policy,cleaning_fee,
  first_review,last_review,host_has_profile_pic,host_identity_verified,latitude,longitude,
  number_of_reviews,review_scores_rating,bedrooms,beds,instant_bookable,bed_type) %>% arrange(id)
head(data_test)
```

::: {.output .display_data}

A data.frame: 6 × 19

| <!--/--> | id &lt;int&gt; | accommodates &lt;int&gt; | bathrooms &lt;dbl&gt; | host_since &lt;chr&gt; | host_response_rate &lt;chr&gt; | cancellation_policy &lt;chr&gt; | cleaning_fee &lt;chr&gt; | first_review &lt;chr&gt; | last_review &lt;chr&gt; | host_has_profile_pic &lt;chr&gt; | host_identity_verified &lt;chr&gt; | latitude &lt;dbl&gt; | longitude &lt;dbl&gt; | number_of_reviews &lt;int&gt; | review_scores_rating &lt;int&gt; | bedrooms &lt;int&gt; | beds &lt;int&gt; | instant_bookable &lt;chr&gt; | bed_type &lt;chr&gt; |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1 |  344 |  5 | 2 | 2015-05-04 | 100% | strict   | True | 2015-10-24 | 2017-04-02 | t | t | 34.07150 | -118.35082 |  9 |  93 | 2 | 3 | f | Real Bed |
| 2 | 2864 |  9 | 1 | 2015-07-08 | 90%  | flexible | True | 2016-07-17 | 2017-03-18 | t | t | 33.77566 | -118.15139 | 10 |  98 | 4 | 5 | t | Real Bed |
| 3 | 3152 | 10 | 1 | 2016-04-01 | 100% | strict   | True | 2016-09-12 | 2017-09-19 | t | t | 40.72261 |  -73.93597 | 25 |  86 | 3 | 4 | f | Real Bed |
| 4 | 3670 |  4 | 1 | 2012-05-13 | 90%  | moderate | True | 2016-11-25 | 2017-05-07 | t | t | 38.97199 |  -77.02329 | 13 | 100 | 1 | 2 | f | Real Bed |
| 5 | 3686 |  3 | 1 | 2012-07-21 | 100% | strict   | True | 2016-11-16 | 2017-04-04 | t | t | 34.08305 | -118.33771 |  5 |  92 | 0 | 2 | f | Real Bed |
| 6 | 3771 |  7 | 1 | 2012-08-06 | 100% | strict   | True | 2016-08-13 | 2017-04-30 | t | t | 34.09419 | -118.29033 | 36 |  96 | 3 | 4 | f | Real Bed |
:::
:::

::: {.cell .markdown}
## Feature Engineering
:::

::: {.cell .markdown}
Feature engineering yang dilakukan adalah dengan mengubah variabel yang
bentuknya date menjadi numerik seperti host since (tanggal awal
penginapan masuk di situs airbnb) yang awalnya bentuknya date diubah
menjadi numerik. Dimana kita mengambil tanggal 01-01-2018 sebagai
tanggal perkiraan analisis dilakukan sehingga bisa dihitung berapa bulan
penginapan tersebut beroperasi.

Pada variabel tingkat respon dicleaning menjadi numerik dengan cara
menghapus simbol \"%\". Selanjutnya beberapa variabel yang bentuknya
kategorikal diubah menjadi numerik atau ordinal.
:::

::: {.cell .code execution_count="7" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:45.410220Z\",\"iopub.status.busy\":\"2023-03-12T21:51:45.409042Z\",\"iopub.status.idle\":\"2023-03-12T21:51:48.727827Z\"}" id="BFMx6HICJHIg" trusted="true"}
``` R
month_now<-as.Date("2018-01-01")
data_train$host_since<-interval(as.Date(data_train$host_since),month_now)%/% months(1)
data_train$host_response_rate<-as.numeric(gsub('%','',data_train$host_response_rate))
data_train$cancellation_policy<-sapply(as.factor(data_train$cancellation_policy), unclass)
data_train$cleaning_fee<-sapply(as.factor(data_train$cleaning_fee), unclass)-1
data_train$first_review<-interval(as.Date(data_train$first_review),month_now)%/% months(1)
data_train$last_review<-interval(as.Date(data_train$last_review),month_now)%/% months(1)
data_train$range_review<-abs(data_train$last_review-data_train$first_review)
data_train$host_has_profile_pic<-sapply(as.factor(data_train$host_has_profile_pic), unclass)-2
data_train$host_has_profile_pic<-ifelse(data_train$host_has_profile_pic==-1,NA,data_train$host_has_profile_pic*1)
data_train$host_identity_verified<-sapply(as.factor(data_train$host_identity_verified), unclass)-2
data_train$host_identity_verified<-ifelse(data_train$host_identity_verified==-1,NA,data_train$host_identity_verified*1)
data_train$instant_bookable<-sapply(as.factor(data_train$instant_bookable), unclass)-1
data_train$bed_type<-sapply(as.factor(data_train$bed_type), unclass)
```
:::

::: {.cell .code execution_count="8" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":306}" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:48.734082Z\",\"iopub.status.busy\":\"2023-03-12T21:51:48.732169Z\",\"iopub.status.idle\":\"2023-03-12T21:51:48.781687Z\"}" id="xALoBJiRKZN6" outputId="50f7e274-279f-4c51-a0a3-aac915468af4" trusted="true"}
``` R
head(data_train)
```

::: {.output .display_data}

A data.frame: 6 × 21

| <!--/--> | id &lt;int&gt; | accommodates &lt;int&gt; | bathrooms &lt;dbl&gt; | host_since &lt;dbl&gt; | host_response_rate &lt;dbl&gt; | cancellation_policy &lt;int&gt; | cleaning_fee &lt;dbl&gt; | first_review &lt;dbl&gt; | last_review &lt;dbl&gt; | host_has_profile_pic &lt;dbl&gt; | ⋯ ⋯ | latitude &lt;dbl&gt; | longitude &lt;dbl&gt; | number_of_reviews &lt;int&gt; | review_scores_rating &lt;int&gt; | bedrooms &lt;int&gt; | beds &lt;int&gt; | instant_bookable &lt;dbl&gt; | bed_type &lt;int&gt; | price &lt;dbl&gt; | range_review &lt;dbl&gt; |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1 |  6901257 | 3 | 1 | 69 |  NA | 3 | 1 | 18 | 17 | 1 | ⋯ | 40.69652 |  -73.99162 |  2 | 100 | 1 | 1 | 0 | 5 | 150 |  1 |
| 2 |  6304928 | 7 | 1 |  6 | 100 | 3 | 1 |  4 |  3 | 1 | ⋯ | 40.76612 |  -73.98904 |  6 |  93 | 3 | 3 | 1 | 5 | 169 |  1 |
| 3 |  7919400 | 5 | 1 | 14 | 100 | 2 | 1 |  8 |  3 | 1 | ⋯ | 40.80811 |  -73.94376 | 10 |  92 | 1 | 3 | 1 | 5 | 145 |  5 |
| 4 | 13418779 | 4 | 1 | 32 |  NA | 1 | 1 | NA | NA | 1 | ⋯ | 37.77200 | -122.43162 |  0 |  NA | 2 | 2 | 0 | 5 | 750 | NA |
| 5 |  3808709 | 2 | 1 | 34 | 100 | 2 | 1 | 31 | 11 | 1 | ⋯ | 38.92563 |  -77.03460 |  4 |  40 | 0 | 1 | 1 | 5 | 115 | 20 |
| 6 | 12422935 | 2 | 1 |  6 | 100 | 3 | 1 |  4 |  3 | 1 | ⋯ | 37.75316 | -122.42953 |  3 | 100 | 1 | 1 | 1 | 5 |  85 |  1 |
:::
:::

::: {.cell .code execution_count="9" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:48.785978Z\",\"iopub.status.busy\":\"2023-03-12T21:51:48.784758Z\",\"iopub.status.idle\":\"2023-03-12T21:51:50.157518Z\"}" id="FP89r7wWJQdt" trusted="true"}
``` R
month_now<-as.Date("2018-01-01")
data_test$host_since<-interval(as.Date(data_test$host_since),month_now)%/% months(1)
data_test$host_response_rate<-as.numeric(gsub('%','',data_test$host_response_rate))
data_test$cancellation_policy<-sapply(as.factor(data_test$cancellation_policy), unclass)
data_test$cleaning_fee<-sapply(as.factor(data_test$cleaning_fee), unclass)-1
data_test$first_review<-interval(as.Date(data_test$first_review),month_now)%/% months(1)
data_test$last_review<-interval(as.Date(data_test$last_review),month_now)%/% months(1)
data_test$range_review<-abs(data_test$last_review-data_test$first_review)
data_test$host_has_profile_pic<-sapply(as.factor(data_test$host_has_profile_pic), unclass)-2
data_test$host_has_profile_pic<-ifelse(data_test$host_has_profile_pic==-1,NA,data_test$host_has_profile_pic*1)
data_test$host_identity_verified<-sapply(as.factor(data_test$host_identity_verified), unclass)-2
data_test$host_identity_verified<-ifelse(data_test$host_identity_verified==-1,NA,data_test$host_identity_verified*1)
data_test$instant_bookable<-sapply(as.factor(data_test$instant_bookable), unclass)-1
data_test$bed_type<-sapply(as.factor(data_test$bed_type), unclass)
```
:::

::: {.cell .code execution_count="10" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":306}" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:50.162599Z\",\"iopub.status.busy\":\"2023-03-12T21:51:50.161175Z\",\"iopub.status.idle\":\"2023-03-12T21:51:50.221697Z\"}" id="MwBix1hHKtHR" outputId="7eee30c6-cda1-4d22-ccc1-c8ece6c5f189" trusted="true"}
``` R
head(data_test)
```

::: {.output .display_data}

A data.frame: 6 × 20

| <!--/--> | id &lt;int&gt; | accommodates &lt;int&gt; | bathrooms &lt;dbl&gt; | host_since &lt;dbl&gt; | host_response_rate &lt;dbl&gt; | cancellation_policy &lt;int&gt; | cleaning_fee &lt;dbl&gt; | first_review &lt;dbl&gt; | last_review &lt;dbl&gt; | host_has_profile_pic &lt;dbl&gt; | host_identity_verified &lt;dbl&gt; | latitude &lt;dbl&gt; | longitude &lt;dbl&gt; | number_of_reviews &lt;int&gt; | review_scores_rating &lt;int&gt; | bedrooms &lt;int&gt; | beds &lt;int&gt; | instant_bookable &lt;dbl&gt; | bed_type &lt;int&gt; | range_review &lt;dbl&gt; |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 1 |  344 |  5 | 2 | 31 | 100 | 3 | 1 | 26 | 8 | 1 | 1 | 34.07150 | -118.35082 |  9 |  93 | 2 | 3 | 0 | 5 | 18 |
| 2 | 2864 |  9 | 1 | 29 |  90 | 1 | 1 | 17 | 9 | 1 | 1 | 33.77566 | -118.15139 | 10 |  98 | 4 | 5 | 1 | 5 |  8 |
| 3 | 3152 | 10 | 1 | 21 | 100 | 3 | 1 | 15 | 3 | 1 | 1 | 40.72261 |  -73.93597 | 25 |  86 | 3 | 4 | 0 | 5 | 12 |
| 4 | 3670 |  4 | 1 | 67 |  90 | 2 | 1 | 13 | 7 | 1 | 1 | 38.97199 |  -77.02329 | 13 | 100 | 1 | 2 | 0 | 5 |  6 |
| 5 | 3686 |  3 | 1 | 65 | 100 | 3 | 1 | 13 | 8 | 1 | 1 | 34.08305 | -118.33771 |  5 |  92 | 0 | 2 | 0 | 5 |  5 |
| 6 | 3771 |  7 | 1 | 64 | 100 | 3 | 1 | 16 | 8 | 1 | 1 | 34.09419 | -118.29033 | 36 |  96 | 3 | 4 | 0 | 5 |  8 |
:::
:::

::: {.cell .markdown}
## Eksplorasi dan Visualisasi Data
:::

::: {.cell .code execution_count="11" execution="{\"iopub.execute_input\":\"2023-03-12T21:51:50.227699Z\",\"iopub.status.busy\":\"2023-03-12T21:51:50.225785Z\",\"iopub.status.idle\":\"2023-03-12T21:52:43.884528Z\"}" trusted="true"}
``` R
DataExplorer::plot_scatterplot(data = data_train,
                               by = "price",nrow = 3,ncol = 3,geom_point_args = list(color="Steelblue"))
```

::: {.output .stream .stderr}
    Warning message:
    “Removed 35029 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 12027 rows containing missing values (`geom_point()`).”
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/03edb7e90e28d3bf11bb8bd8835470ba3114a81d.png){height="420"
width="420"}
:::

::: {.output .stream .stderr}
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/e003b30cc7c2acd8be0167868be80ccae9d1a99f.png){height="420"
width="420"}
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/c32e0f0a40d69131b9990013807d431fcbd21b37.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="12" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:43.892918Z\",\"iopub.status.busy\":\"2023-03-12T21:52:43.889453Z\",\"iopub.status.idle\":\"2023-03-12T21:52:44.064521Z\"}" trusted="true"}
``` R
# menghitung kernel density
dens <- density(data_train$accommodates)
# histogram
hist(data_train$accommodates, freq=FALSE, col="#69b3a2")
# tambahkan density plot
polygon(dens, border="darkblue")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/a837b9361dc5b9b602e80f9fade9fb7417772337.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="13" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:44.075424Z\",\"iopub.status.busy\":\"2023-03-12T21:52:44.071119Z\",\"iopub.status.idle\":\"2023-03-12T21:52:44.203734Z\"}" trusted="true"}
``` R
# menghitung kernel density
dens <- density(data_train$number_of_reviews)
# histogram
hist(data_train$number_of_reviews, freq=FALSE, col="#69b3a2")
# tambahkan density plot
polygon(dens, border="darkblue")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/7ae0682ca6b788ecace4064462aa3bc6969ebe9c.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="14" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:44.211750Z\",\"iopub.status.busy\":\"2023-03-12T21:52:44.208529Z\",\"iopub.status.idle\":\"2023-03-12T21:52:44.903436Z\"}" trusted="true"}
``` R
ggplot(data = data_train, mapping = aes(x = bed_type, y = price)) +
    geom_boxplot(alpha = 0.5) 
```

::: {.output .stream .stderr}
    Warning message:
    “Continuous x aesthetic
    ℹ did you forget `aes(group = ...)`?”
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/5aba2bb7a6559d471c3a24850ffab7352ae20414.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="15" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:44.912470Z\",\"iopub.status.busy\":\"2023-03-12T21:52:44.908732Z\",\"iopub.status.idle\":\"2023-03-12T21:52:49.563893Z\"}" trusted="true"}
``` R
data_train_plot<-read.csv("/kaggle/input/sta1582-sesi-uts-genap-2023/train.csv")
ggplot(data = data_train_plot, aes(x = bed_type, y = price, color = bed_type)) +
    geom_line() +
    facet_wrap(vars(city)) +
    labs(title = "Observasi Harga pada Tiap Kota",
         x = "Tipe Tempat Tidur",
         y = "Harga") +
    theme_bw()
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/0a71e9954e7615cc3e54de7a39a401cb3959edf7.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="16" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:49.568994Z\",\"iopub.status.busy\":\"2023-03-12T21:52:49.567108Z\",\"iopub.status.idle\":\"2023-03-12T21:52:50.170011Z\"}" trusted="true"}
``` R
data_train_plot%>%
  filter(city %in% c("Boston","Chicago"
                     ,"DC","LA","NYC",
                     "NF")
         )%>%
  ggplot() +
  geom_boxplot(aes(x = city,y = price,fill=city),show.legend = F) +
  ggtitle("Sebaran Harga Penginapan Setiap Kota") +
  ylab("Harga Penginapan") +
  xlab("Kota") + 
  theme(plot.title = element_text(hjust = 0.5))+
  theme_bw()
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/b132312a08dc54de00af7559286654b825d4d53b.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="17" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:50.174983Z\",\"iopub.status.busy\":\"2023-03-12T21:52:50.173386Z\",\"iopub.status.idle\":\"2023-03-12T21:52:50.407034Z\"}" trusted="true"}
``` R
data_train_plot%>%count(city)%>%
  mutate(city=fct_reorder(as.factor(city),desc(n)))%>%
  ggplot()+
  geom_segment(aes(x=city,xend=city, y=0, yend=n), color="skyblue")+
  geom_point(aes(x=city,y=n),color="steelblue", size=2)+ 
    scale_y_continuous(expand = c(0,0))+
    coord_flip() +
    ggtitle("Jumlah Penginapan Setiap Kota") +
    xlab("") +
    ylab("Jumlah Penginapan") +
    theme(plot.title = element_text(hjust = 0.5))
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/afc6831c61de85821458b639e26585b5d71cabee.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="18" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:50.411621Z\",\"iopub.status.busy\":\"2023-03-12T21:52:50.410416Z\",\"iopub.status.idle\":\"2023-03-12T21:52:50.686275Z\"}" trusted="true"}
``` R
mc<-cor(data_train[,-15],use = "complete.obs")
corrplot::corrplot(mc,method="number")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/c7a10ac2e0cc2ad6922de8eab086216e4d556192.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="19" execution="{\"iopub.execute_input\":\"2023-03-12T21:52:50.691411Z\",\"iopub.status.busy\":\"2023-03-12T21:52:50.689473Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.231821Z\"}" trusted="true"}
``` R
selected_variable<-data_train %>% 
select(accommodates,host_since,host_response_rate,first_review,last_review,range_review,
       number_of_reviews,price)
ggpairs(selected_variable,alpha = 0.5)
```

::: {.output .stream .stderr}
    Warning message in warn_if_args_exist(list(...)):
    “Extra arguments: 'alpha' are being ignored.  If these are meant to be aesthetics, submit them using the 'mapping' variable within ggpairs with ggplot2::aes or ggplot2::aes_string.”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 128 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 12754 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 10989 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message:
    “Removed 128 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 128 rows containing non-finite values (`stat_density()`).”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 12754 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11110 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11089 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11110 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 128 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 128 rows containing missing values”
    Warning message:
    “Removed 12754 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 12754 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 12754 rows containing non-finite values (`stat_density()`).”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 17943 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 17924 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 17943 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 12754 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 12754 rows containing missing values”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11110 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 17943 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing non-finite values (`stat_density()`).”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message:
    “Removed 10989 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11089 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 17924 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 10989 rows containing non-finite values (`stat_density()`).”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 10989 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 10989 rows containing missing values”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11110 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 17943 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing non-finite values (`stat_density()`).”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    “Removed 11014 rows containing missing values”
    Warning message:
    “Removed 128 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 12754 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 10989 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 128 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 12754 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 10989 rows containing missing values (`geom_point()`).”
    Warning message:
    “Removed 11014 rows containing missing values (`geom_point()`).”
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/a02bc317375aa4fc257fdc98575a2dde7fd21d1a.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="20" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.237068Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.235168Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.515861Z\"}" trusted="true"}
``` R
layout(matrix(1:6, nrow = 2, byrow = TRUE))
freq_Cl<-table(data_train$cleaning_fee)
colour<-c("#69b3a2","#F08080")
bp<-barplot(freq_Cl, main="Adanya Biaya Kebersihan",xlab="Fee",col=colour, beside=TRUE,ylim=c(0,max(freq_Cl)+10000))
text(x=bp, y = freq_Cl, label = freq_Cl, pos = 3, cex = 0.8, col = "black")

freq_host<-table(data_train$host_identity_verified)
colour<-c("#69b3a2","#F08080")
bp<-barplot(freq_host, main="Status Verifikasi Pemilik Penginapan",xlab="Verified",col=colour, beside=TRUE,ylim=c(0,max(freq_host)+10000))
text(x=bp, y = freq_host, label = freq_host, pos = 3, cex = 0.8, col = "black")

freq_book<-table(data_train$instant_bookable)
colour<-c("#69b3a2","#F08080")
bp<-barplot(freq_book, main="Kemudahan Pemesanan Diawal",xlab="Instant Bookable",col=colour, beside=TRUE,ylim=c(0,max(freq_book)+10000))
text(x=bp, y = freq_book, label = freq_book, pos = 3, cex = 0.8, col = "black")

freq_pict<-table(data_train$host_has_profile_pic)
colour<-c("#69b3a2","#F08080")
bp<-barplot(freq_pict, main="Memiliki Foto Profil",xlab="Profil Pict",col=colour, beside=TRUE,ylim=c(0,max(freq_pict)+10000))
text(x=bp, y = freq_pict, label = freq_pict, pos = 3, cex = 0.8, col = "black")

freq_canc<-table(data_train$cancellation_policy)
colour<-c("#69b3a2","#F08080","#6495ED","#EEE8AA","#00CED1")
bp<-barplot(freq_canc, main="Kebijakan Pembatalan Reservasi",xlab="Cancelling Policy",legend.text = TRUE, args.legend = list(x = "topright", legend=c("1 = Flexible","2 = Moderate", "3 = Strict", "4 = Super Strict-30", "5 = Super Strict-60"),inset = c(- 0.009, 0),cex=0.7,bty = "n"),col=colour, beside=TRUE,ylim=c(0,max(freq_canc)+10000))
text(x=bp, y = freq_canc, label = freq_canc, pos = 3, cex = 0.8, col = "black")

freq_bedT<-table(data_train$bed_type)
colour<-c("#69b3a2","#F08080","#6495ED","#EEE8AA","#00CED1")
bp<-barplot(freq_bedT, main="Jenis Tempat Tidur",xlab="Bed Type",legend.text = TRUE, args.legend = list(x = "topleft", legend=c("1 = Airbed","2 = Couch", "3 = Futon", "4 = Pull-out sofa", "5 = Realbed"),inset = c( 0.05, 0),cex=0.7,bty = "n"),col=colour, beside=TRUE,ylim=c(0,max(freq_bedT)+10000))
text(x=bp, y = freq_bedT, label = freq_bedT, pos = 3, cex = 0.8, col = "black")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/d3d819414e0fb7a1cd0b00390531dc4e30ccfbd5.png){height="420"
width="420"}
:::
:::

::: {.cell .markdown}
## Data Imputation
:::

::: {.cell .markdown}
Berdasarkan eksplorasi data yang dilakukan ditemukan banyak data missing
sehingga untuk melakukan pemodelan terlebih dahulu dilakukan imputasi
data. Imputasi data yang dilakukan adalah dengan mengganti nilai pada
variabel dengan ukuran pemusatan data seperti median (untuk data yang
bersifat kontinu atau diskret) dan modus (untuk data yang bersifat
kategorikal).
:::

::: {.cell .code execution_count="21" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.520842Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.519270Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.585350Z\"}" id="De45fndVJV9p" trusted="true"}
``` R
numr<-c(3,4,5,8,9,15,16,21)
catr<-c(10,11,17)
all_column_median <- apply(data_train[,numr], 2, median, na.rm=TRUE)
for(i in 1:length(numr)){
  data_train[,numr[i]][is.na(data_train[,numr[i]])] <- all_column_median[i]
}
mode <- function(x, na.rm = FALSE) {
  if(na.rm){
    x = x[!is.na(x)]
  }
  ux <- unique(x)
  return(ux[which.max(tabulate(match(x, ux)))])
}
all_column_modes <- apply(data_train[,catr], 2, mode, na.rm=TRUE)
for(i in 1:length(catr)){
  data_train[,catr[i]][is.na(data_train[,catr[i]])] <- all_column_modes[i]
}
```
:::

::: {.cell .code execution_count="22" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.589858Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.588524Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.639493Z\"}" id="-P3NDo2AJdVH" trusted="true"}
``` R
numr<-c(3,4,5,8,9,15,16,20)
catr<-c(10,11,17)
all_column_median <- apply(data_test[,numr], 2, median, na.rm=TRUE)
for(i in 1:length(numr)){
  data_test[,numr[i]][is.na(data_test[,numr[i]])] <- all_column_median[i]
}
mode <- function(x, na.rm = FALSE) {
  if(na.rm){
    x = x[!is.na(x)]
  }
  ux <- unique(x)
  return(ux[which.max(tabulate(match(x, ux)))])
}
all_column_modes <- apply(data_test[,catr], 2, mode, na.rm=TRUE)
for(i in 1:length(catr)){
  data_test[,catr[i]][is.na(data_test[,catr[i]])] <- all_column_modes[i]
}
```
:::

::: {.cell .code execution_count="23" colab="{\"base_uri\":\"https://localhost:8080/\"}" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.643643Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.642424Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.672792Z\"}" id="k5XWeOEpK50Q" outputId="d6c352b6-411e-48f3-d166-0ee8112720c3" trusted="true"}
``` R
cat(colSums(is.na(data_train)),"\n")
cat(colSums(is.na(data_test)),"\n")
```

::: {.output .stream .stdout}
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
:::
:::

::: {.cell .markdown}
## Partition Data
:::

::: {.cell .markdown}
Pada partisi data dilakukan pembagian data untuk modelling sebesar 80%
dan data untuk validasi sebesar 20%.
:::

::: {.cell .code execution_count="24" colab="{\"base_uri\":\"https://localhost:8080/\",\"height\":34}" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.677275Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.675970Z\",\"iopub.status.idle\":\"2023-03-12T21:53:52.745911Z\"}" id="5BKqSqXaMMlc" outputId="7b75cd5f-6a0e-42e6-f4ff-230bd309a23e" trusted="true"}
``` R
set.seed(122)
training<-data_train[,-c(1,8,9,12,13)]
n=nrow(training)
index<-sample(c(1:n),size=0.8*n,replace=F)
data_latih<-training[index,]
data_uji<-training[-index,]
c(nrow(data_latih),nrow(data_uji))
```

::: {.output .display_data}
1. 41503
2. 10376
:::
:::

::: {.cell .markdown}
## Data Modelling
:::

::: {.cell .markdown}
### Model Linear, LASSO, Ridge, Elastic NET
:::

::: {.cell .code execution_count="25" execution="{\"iopub.execute_input\":\"2023-03-12T21:53:52.750010Z\",\"iopub.status.busy\":\"2023-03-12T21:53:52.748782Z\",\"iopub.status.idle\":\"2023-03-12T21:53:55.131601Z\"}" trusted="true"}
``` R
set.seed(39)
model_lm<-lm(log(price,10)~.,data=data_latih)
x_train<-as.matrix(data_latih[,-c(15)])
y_train<-log(data_latih$price,10)
model_ridge_cv <- cv.glmnet(x_train, y_train,alpha = 0,
                         type.measure="mse",
                         family="gaussian",
                         nfolds=5)
model_ridge<-glmnet(x_train, y_train, alpha=0, lambda = model_ridge_cv$lambda.1se)
model_lasso_cv <- cv.glmnet(x_train, y_train,alpha = 1,
                         type.measure="mse",
                         family="gaussian",
                         nfolds=5)
model_lasso<-glmnet(x_train, y_train, alpha=1, lambda = model_lasso_cv$lambda.1se)
model_elnet_cv <- cv.glmnet(x_train, y_train,alpha = 0.5,
                         type.measure="mse",
                         family="gaussian",
                         nfolds=5)
model_elnet<-glmnet(x_train, y_train, alpha=0.5, lambda = model_elnet_cv$lambda.1se)

rsq<-function(pred){
SS.total      <- sum((data_uji$price - mean(data_uji$price))^2)
SS.residual   <- sum((data_uji$price - pred)^2)
SS.regression <- sum((pred - mean(data_uji$price)^2))
test.rsq <- 1 - SS.residual/SS.total  
return(test.rsq)
}

x_test<-as.matrix(data_uji[,-c(15)])
linear_pred = 10^(predict(model_lm,data_uji))
ridge_pred = 10^(predict(model_ridge,newx = x_test))
lasso_pred = 10^(predict(model_lasso,newx = x_test))
elnet_pred = 10^(predict(model_elnet,newx = x_test))

rangkuman1<-data.frame(model=c("Linear","Ridge","Lasso","Elastic-Net"),
                       lambda=c(0,model_ridge_cv$lambda.1se,model_lasso_cv$lambda.1se,model_elnet_cv$lambda.1se),
                       rsq=c(rsq(linear_pred),rsq(ridge_pred),rsq(lasso_pred),rsq(elnet_pred)))
rangkuman1
```

::: {.output .display_data}

A data.frame: 4 × 3

| model &lt;chr&gt; | lambda &lt;dbl&gt; | rsq &lt;dbl&gt; |
|---|---|---|
| Linear      | 0.000000000 | 0.2036839 |
| Ridge       | 0.044785596 | 0.2421583 |
| Lasso       | 0.005651301 | 0.2157233 |
| Elastic-Net | 0.008550004 | 0.2222098 |
:::
:::

::: {.cell .code execution_count="79" execution="{\"iopub.execute_input\":\"2023-03-13T01:58:04.444111Z\",\"iopub.status.busy\":\"2023-03-13T01:58:04.439656Z\",\"iopub.status.idle\":\"2023-03-13T01:58:04.829295Z\"}" trusted="true"}
``` R
plot(model_lasso_cv,main="Find Optimal Lambda LASSO")
plot(model_ridge_cv,main="Find Optimal Lambda Ridge")
plot(model_elnet_cv,main="Find Optimal Lambda Elastic Net")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/d18dddc7b555ae15e4a0e2ec0e7e063a528d072f.png){height="420"
width="420"}
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/c72e3e0058749f222c578040bc3d3f97a397bc81.png){height="420"
width="420"}
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/853bfa412ee6169a5acb4eb0e460447826973fa0.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="46" execution="{\"iopub.execute_input\":\"2023-03-13T00:45:39.419293Z\",\"iopub.status.busy\":\"2023-03-13T00:45:39.416840Z\",\"iopub.status.idle\":\"2023-03-13T00:45:39.440531Z\"}" trusted="true"}
``` R
model_lm
```

::: {.output .display_data}

    Call:
    lm(formula = log(price, 10) ~ ., data = data_latih)

    Coefficients:
               (Intercept)            accommodates               bathrooms  
                 1.2400631               0.0780428               0.0343623  
                host_since      host_response_rate     cancellation_policy  
                 0.0010640              -0.0001034               0.0093957  
              cleaning_fee    host_has_profile_pic  host_identity_verified  
                 0.0059638              -0.0559922              -0.0226966  
         number_of_reviews    review_scores_rating                bedrooms  
                -0.0007257               0.0037726               0.0467441  
                      beds        instant_bookable                bed_type  
                -0.0291374              -0.0282694               0.0408529  
              range_review  
                 0.0012060  
:::
:::

::: {.cell .code execution_count="49" execution="{\"iopub.execute_input\":\"2023-03-13T00:47:54.830350Z\",\"iopub.status.busy\":\"2023-03-13T00:47:54.828225Z\",\"iopub.status.idle\":\"2023-03-13T00:47:54.862758Z\"}" trusted="true"}
``` R
model_lasso$beta
```

::: {.output .display_data}
    15 x 1 sparse Matrix of class "dgCMatrix"
                                      s0
    accommodates            0.0669366207
    bathrooms               0.0239655949
    host_since              0.0008795680
    host_response_rate      .           
    cancellation_policy     0.0029696399
    cleaning_fee            .           
    host_has_profile_pic    .           
    host_identity_verified -0.0039693372
    number_of_reviews      -0.0004150137
    review_scores_rating    0.0030216650
    bedrooms                0.0371987714
    beds                   -0.0011937306
    instant_bookable       -0.0211819254
    bed_type                0.0275917345
    range_review            0.0004367163
:::
:::

::: {.cell .code execution_count="50" execution="{\"iopub.execute_input\":\"2023-03-13T00:49:07.885249Z\",\"iopub.status.busy\":\"2023-03-13T00:49:07.882975Z\",\"iopub.status.idle\":\"2023-03-13T00:49:07.906419Z\"}" trusted="true"}
``` R
model_ridge$beta
```

::: {.output .display_data}
    15 x 1 sparse Matrix of class "dgCMatrix"
                                      s0
    accommodates            0.0547370200
    bathrooms               0.0362813415
    host_since              0.0009399523
    host_response_rate     -0.0001092574
    cancellation_policy     0.0104689329
    cleaning_fee            0.0116981926
    host_has_profile_pic   -0.0529182794
    host_identity_verified -0.0165709979
    number_of_reviews      -0.0005529390
    review_scores_rating    0.0033252085
    bedrooms                0.0494534954
    beds                    0.0009655719
    instant_bookable       -0.0260254627
    bed_type                0.0370726144
    range_review            0.0008525339
:::
:::

::: {.cell .code execution_count="51" execution="{\"iopub.execute_input\":\"2023-03-13T00:50:08.116877Z\",\"iopub.status.busy\":\"2023-03-13T00:50:08.114547Z\",\"iopub.status.idle\":\"2023-03-13T00:50:08.138893Z\"}" trusted="true"}
``` R
model_elnet$beta
```

::: {.output .display_data}
    15 x 1 sparse Matrix of class "dgCMatrix"
                                      s0
    accommodates            0.0668347305
    bathrooms               0.0267722711
    host_since              0.0009122345
    host_response_rate      .           
    cancellation_policy     0.0050652762
    cleaning_fee            .           
    host_has_profile_pic    .           
    host_identity_verified -0.0079934219
    number_of_reviews      -0.0004760242
    review_scores_rating    0.0031633768
    bedrooms                0.0403020789
    beds                   -0.0044834630
    instant_bookable       -0.0226809421
    bed_type                0.0306348666
    range_review            0.0005977389
:::
:::

::: {.cell .markdown}
### Model Regression Tree
:::

::: {.cell .code execution_count="61" execution="{\"iopub.execute_input\":\"2023-03-13T01:01:27.775629Z\",\"iopub.status.busy\":\"2023-03-13T01:01:27.771372Z\",\"iopub.status.idle\":\"2023-03-13T01:01:44.587052Z\"}" trusted="true"}
``` R
set.seed(745)
tune_rtree_all = train(log(price,10) ~ ., 
                    data = data_latih, 
                    method = "rpart",  
                    tuneLength = 100,  
                    metric = "Rsquared",  
                    trControl = trainControl(
                      method = "cv",  
                      number = 5, 
                      )
                    )
tune_rtree_all
```

::: {.output .stream .stderr}
    Warning message in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, :
    “There were missing values in resampled performance measures.”
:::

::: {.output .display_data}
    CART 

    41503 samples
       15 predictor

    No pre-processing
    Resampling: Cross-Validated (5 fold) 
    Summary of sample sizes: 33202, 33202, 33202, 33204, 33202 
    Resampling results across tuning parameters:

      cp            RMSE       Rsquared   MAE      
      0.0002008812  0.2288512  0.4606132  0.1758272
      0.0002021518  0.2288191  0.4607570  0.1758141
      0.0002042454  0.2288169  0.4607492  0.1758193
      0.0002082459  0.2287851  0.4608834  0.1758045
      0.0002092338  0.2288093  0.4607659  0.1758204
      0.0002125823  0.2288063  0.4607694  0.1758139
      0.0002126748  0.2288149  0.4607289  0.1758242
      0.0002173802  0.2287145  0.4611662  0.1757703
      0.0002218352  0.2286982  0.4612128  0.1757820
      0.0002245754  0.2286922  0.4612290  0.1757840
      0.0002265382  0.2287156  0.4611191  0.1758043
      0.0002271865  0.2287029  0.4611775  0.1757982
      0.0002289543  0.2286988  0.4611822  0.1758154
      0.0002385901  0.2286538  0.4613792  0.1758660
      0.0002392773  0.2286538  0.4613792  0.1758660
      0.0002409582  0.2286726  0.4612936  0.1758809
      0.0002418434  0.2286875  0.4612198  0.1758933
      0.0002450835  0.2286735  0.4612780  0.1758876
      0.0002503109  0.2286917  0.4611603  0.1758980
      0.0002531383  0.2286441  0.4613790  0.1758563
      0.0002563100  0.2285908  0.4616225  0.1758460
      0.0002591948  0.2286375  0.4614057  0.1758609
      0.0002602653  0.2286599  0.4612967  0.1758804
      0.0002612337  0.2286687  0.4612548  0.1758709
      0.0002738358  0.2287073  0.4610568  0.1759547
      0.0002808257  0.2287425  0.4608860  0.1759960
      0.0002815515  0.2287728  0.4607446  0.1760253
      0.0002825558  0.2287840  0.4606928  0.1760310
      0.0002855777  0.2288022  0.4606097  0.1760457
      0.0002857581  0.2288140  0.4605559  0.1760563
      0.0002881496  0.2288241  0.4605124  0.1760568
      0.0002895318  0.2288665  0.4603092  0.1760841
      0.0002945671  0.2289458  0.4599266  0.1762001
      0.0003009548  0.2290534  0.4594071  0.1762674
      0.0003011087  0.2290534  0.4594071  0.1762674
      0.0003046340  0.2290536  0.4594047  0.1762609
      0.0003047064  0.2290536  0.4594047  0.1762609
      0.0003102341  0.2290868  0.4592500  0.1762760
      0.0003106232  0.2290868  0.4592500  0.1762760
      0.0003157021  0.2290419  0.4594598  0.1762580
      0.0003177615  0.2290419  0.4594598  0.1762580
      0.0003193110  0.2290649  0.4593553  0.1762778
      0.0003204112  0.2290703  0.4593204  0.1762789
      0.0003262848  0.2291591  0.4588958  0.1763202
      0.0003321584  0.2292168  0.4586270  0.1763661
      0.0003385190  0.2292995  0.4582402  0.1764535
      0.0003590171  0.2294170  0.4576835  0.1765427
      0.0003663920  0.2294818  0.4573767  0.1766012
      0.0003733384  0.2295094  0.4572405  0.1766090
      0.0003850302  0.2296268  0.4566842  0.1766779
      0.0004097349  0.2297134  0.4562578  0.1767842
      0.0004101775  0.2297134  0.4562578  0.1767842
      0.0004290637  0.2297999  0.4558488  0.1768675
      0.0004360311  0.2298212  0.4557472  0.1768904
      0.0004388635  0.2297960  0.4558645  0.1768640
      0.0004585135  0.2300827  0.4545124  0.1770485
      0.0004716940  0.2301330  0.4542694  0.1770615
      0.0004943346  0.2301815  0.4540374  0.1770485
      0.0004975035  0.2301815  0.4540374  0.1770485
      0.0005413632  0.2307565  0.4513177  0.1774054
      0.0005497774  0.2308209  0.4510136  0.1774576
      0.0005547042  0.2309067  0.4506150  0.1774988
      0.0005557183  0.2309067  0.4506150  0.1774988
      0.0005558268  0.2309067  0.4506150  0.1774988
      0.0005818102  0.2310336  0.4500056  0.1775580
      0.0006222922  0.2312795  0.4488456  0.1777484
      0.0006709813  0.2313939  0.4482937  0.1778181
      0.0007026262  0.2314810  0.4478769  0.1779121
      0.0007084318  0.2314810  0.4478769  0.1779121
      0.0007821106  0.2317024  0.4468109  0.1780738
      0.0008567929  0.2324004  0.4434631  0.1785693
      0.0009058055  0.2326387  0.4423234  0.1786884
      0.0009152415  0.2326772  0.4421396  0.1787179
      0.0009411120  0.2327518  0.4417811  0.1787197
      0.0009668658  0.2327518  0.4417811  0.1787197
      0.0009848831  0.2327518  0.4417811  0.1787197
      0.0010906947  0.2329194  0.4409473  0.1787452
      0.0010910673  0.2329194  0.4409473  0.1787452
      0.0012064153  0.2333093  0.4390896  0.1788604
      0.0013284445  0.2335394  0.4379548  0.1789604
      0.0015004086  0.2339996  0.4357600  0.1793058
      0.0015081653  0.2340498  0.4355180  0.1793314
      0.0015702842  0.2345135  0.4332867  0.1796841
      0.0016180647  0.2345250  0.4332322  0.1797024
      0.0016904126  0.2347296  0.4322544  0.1798475
      0.0018816854  0.2352184  0.4299025  0.1801844
      0.0020731800  0.2358320  0.4269394  0.1807421
      0.0021385838  0.2358957  0.4266215  0.1807798
      0.0022892790  0.2359902  0.4261541  0.1808854
      0.0024987029  0.2366808  0.4227890  0.1813406
      0.0039178354  0.2379908  0.4163898  0.1822986
      0.0040667772  0.2384663  0.4140416  0.1826242
      0.0050446263  0.2391268  0.4107982  0.1830523
      0.0053960734  0.2401104  0.4059352  0.1834981
      0.0079409284  0.2419478  0.3967519  0.1848145
      0.0126419285  0.2450226  0.3813234  0.1875483
      0.0268712112  0.2478407  0.3669948  0.1903866
      0.0334304579  0.2538816  0.3356581  0.1952122
      0.0486309309  0.2626752  0.2889598  0.2025338
      0.2709344170  0.2847050  0.2671740  0.2214333

    Rsquared was used to select the optimal model using the largest value.
    The final value used for the model was cp = 0.00025631.
:::
:::

::: {.cell .code execution_count="67" execution="{\"iopub.execute_input\":\"2023-03-13T01:11:09.029119Z\",\"iopub.status.busy\":\"2023-03-13T01:11:09.027014Z\",\"iopub.status.idle\":\"2023-03-13T01:11:09.201366Z\"}" trusted="true"}
``` R
plot(tune_rtree_all)
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/918f0adcb4771792304b33987ecd4907da096763.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="27" execution="{\"iopub.execute_input\":\"2023-03-12T21:54:11.955824Z\",\"iopub.status.busy\":\"2023-03-12T21:54:11.954484Z\",\"iopub.status.idle\":\"2023-03-12T21:54:12.141923Z\"}" trusted="true"}
``` R
plot(varImp(tune_rtree_all))
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/1cc731b48f768c710980ec1ac11857a572dad16e.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="62" execution="{\"iopub.execute_input\":\"2023-03-13T01:02:26.647360Z\",\"iopub.status.busy\":\"2023-03-13T01:02:26.645308Z\",\"iopub.status.idle\":\"2023-03-13T01:02:29.897607Z\"}" trusted="true"}
``` R
rtree_best_model <- rpart(log(price,10) ~ ., 
            data = data_latih,
            method = 'anova',
            cp  = tune_rtree_all$bestTune, 
            #importance = "impurity",
            #verbose = FALSE
            )
rtree_best_model
```

::: {.output .display_data}
    n= 41503 

    node), split, n, deviance, yval
          * denotes terminal node

       1) root 41503 4.026875e+03 2.074947  
         2) bedrooms< 1.5 31840 2.139886e+03 1.985628  
           4) accommodates< 1.5 5286 3.080222e+02 1.809854  
             8) bedrooms>=0.5 4991 2.811449e+02 1.801445  
              16) host_since< 32.5 2306 1.418248e+02 1.763901  
                32) bathrooms>=1.75 193 8.447805e+00 1.619473  
                  64) instant_bookable>=0.5 94 3.941187e+00 1.539460  
                   128) cancellation_policy>=2.5 59 1.426235e+00 1.452467 *
                   129) cancellation_policy< 2.5 35 1.315791e+00 1.686105 *
                  65) instant_bookable< 0.5 99 3.333410e+00 1.695445 *
                33) bathrooms< 1.75 2113 1.289834e+02 1.777093  
                  66) number_of_reviews>=0.5 1274 5.696862e+01 1.743376  
                   132) review_scores_rating< 96.5 629 2.920412e+01 1.711646 *
                   133) review_scores_rating>=96.5 645 2.651367e+01 1.774319 *
                  67) number_of_reviews< 0.5 839 6.836724e+01 1.828291 *
              17) host_since>=32.5 2685 1.332781e+02 1.833689  
                34) number_of_reviews>=0.5 1920 7.711515e+01 1.814406 *
                35) number_of_reviews< 0.5 765 5.365708e+01 1.882087 *
             9) bedrooms< 0.5 295 2.055399e+01 1.952117 *
           5) accommodates>=1.5 26554 1.636033e+03 2.020618  
            10) accommodates< 2.5 17461 9.574095e+02 1.974552  
              20) bedrooms>=0.5 15148 8.325065e+02 1.957830  
                40) review_scores_rating< 95.5 5120 2.416034e+02 1.912665  
                  80) host_since< 38.5 2291 1.095557e+02 1.869916  
                   160) host_since< 23.5 1030 4.791028e+01 1.839185  
                     320) bathrooms>=2.75 21 9.221586e-01 1.618075 *
                     321) bathrooms< 2.75 1009 4.594007e+01 1.843787 *
                   161) host_since>=23.5 1261 5.987813e+01 1.895017 *
                  81) host_since>=38.5 2829 1.244704e+02 1.947284  
                   162) cancellation_policy< 3.5 2818 1.221991e+02 1.945550  
                     324) bathrooms>=1.25 316 1.248507e+01 1.877463 *
                     325) bathrooms< 1.25 2502 1.080641e+02 1.954149  
                       650) host_since< 65.5 1742 7.557216e+01 1.939891 *
                       651) host_since>=65.5 760 3.132601e+01 1.986831 *
                   163) cancellation_policy>=3.5 11 9.129285e-02 2.391594 *
                41) review_scores_rating>=95.5 10028 5.751265e+02 1.980890  
                  82) host_since< 36.5 4598 2.881822e+02 1.947941  
                   164) range_review< 8.5 2027 1.000107e+02 1.916056  
                     328) review_scores_rating< 99.5 621 2.513055e+01 1.880960  
                       656) host_response_rate>=34.5 611 2.369272e+01 1.875716 *
                       657) host_response_rate< 34.5 10 3.940913e-01 2.201419 *
                     329) review_scores_rating>=99.5 1406 7.377748e+01 1.931556 *
                   165) range_review>=8.5 2571 1.844859e+02 1.973080  
                     330) host_since< 10.5 254 1.409878e+01 1.883974 *
                     331) host_since>=10.5 2317 1.681493e+02 1.982848  
                       662) number_of_reviews>=22.5 506 1.888431e+01 1.928681 *
                       663) number_of_reviews< 22.5 1811 1.473655e+02 1.997982  
                        1326) cleaning_fee>=0.5 983 6.044197e+01 1.975754 *
                        1327) cleaning_fee< 0.5 828 8.586116e+01 2.024373  
                          2654) host_since>=11.5 806 7.916282e+01 2.017319 *
                          2655) host_since< 11.5 22 5.189060e+00 2.282792 *
                  83) host_since>=36.5 5430 2.777257e+02 2.008790  
                   166) cancellation_policy< 2.5 3478 1.742881e+02 1.994446  
                     332) number_of_reviews>=0.5 2438 9.796681e+01 1.979776  
                       664) bed_type< 4.5 115 3.521482e+00 1.859120 *
                       665) bed_type>=4.5 2323 9.268828e+01 1.985750  
                        1330) range_review< 28.5 1902 7.825389e+01 1.975738 *
                        1331) range_review>=28.5 421 1.338244e+01 2.030981 *
                     333) number_of_reviews< 0.5 1040 7.456661e+01 2.028836 *
                   167) cancellation_policy>=2.5 1952 1.014471e+02 2.034348  
                     334) range_review< 45.5 1729 9.035009e+01 2.025344  
                       668) cancellation_policy< 3.5 1719 8.913046e+01 2.023368 *
                       669) cancellation_policy>=3.5 10 5.928663e-02 2.364995 *
                     335) range_review>=45.5 223 9.869952e+00 2.104160 *
              21) bedrooms< 0.5 2313 9.292583e+01 2.084068  
                42) review_scores_rating< 95.5 849 2.533224e+01 2.050589 *
                43) review_scores_rating>=95.5 1464 6.609020e+01 2.103482 *
            11) accommodates>=2.5 9093 5.704164e+02 2.109078  
              22) bathrooms>=2.25 143 1.712265e+01 1.725341  
                44) beds>=4.5 42 1.544083e+00 1.425408 *
                45) beds< 4.5 101 1.022909e+01 1.850065  
                  90) accommodates< 4.5 78 5.298464e+00 1.791377  
                   180) beds>=3.5 15 2.506111e-01 1.502796 *
                   181) beds< 3.5 63 3.501241e+00 1.860087 *
                  91) accommodates>=4.5 23 3.750888e+00 2.049094  
                   182) host_since>=30.5 16 1.094578e+00 1.897263 *
                   183) host_since< 30.5 7 1.444403e+00 2.396135 *
              23) bathrooms< 2.25 8950 5.318999e+02 2.115209  
                46) number_of_reviews>=0.5 7443 3.526372e+02 2.092867  
                  92) accommodates< 15 7416 3.397654e+02 2.090815  
                   184) review_scores_rating< 96.5 4276 1.944114e+02 2.064852  
                     368) accommodates< 3.5 1846 7.724174e+01 2.032262  
                       736) bathrooms>=1.25 120 6.848866e+00 1.912319 *
                       737) bathrooms< 1.25 1726 6.854650e+01 2.040601  
                        1474) host_since< 49.5 1125 4.606679e+01 2.020254  
                          2948) bedrooms>=0.5 899 3.963191e+01 2.004309 *
                          2949) bedrooms< 0.5 226 5.297065e+00 2.083683 *
                        1475) host_since>=49.5 601 2.114215e+01 2.078688 *
                     369) accommodates>=3.5 2430 1.137195e+02 2.089610  
                       738) beds>=3.5 148 1.158309e+01 1.970558 *
                       739) beds< 3.5 2282 9.990267e+01 2.097332  
                        1478) host_since< 45.5 1351 6.101402e+01 2.077412 *
                        1479) host_since>=45.5 931 3.757475e+01 2.126237 *
                   185) review_scores_rating>=96.5 3140 1.385468e+02 2.126170  
                     370) accommodates< 3.5 1422 6.068474e+01 2.096984 *
                     371) accommodates>=3.5 1718 7.564822e+01 2.150327  
                       742) beds>=3.5 81 7.568286e+00 2.014615  
                        1484) bathrooms>=1.75 14 1.125995e+00 1.680456 *
                        1485) bathrooms< 1.75 67 4.552369e+00 2.084439 *
                       743) beds< 3.5 1637 6.651429e+01 2.157042  
                        1486) range_review< 27.5 1468 5.846768e+01 2.147808  
                          2972) number_of_reviews>=9.5 664 2.177575e+01 2.117000 *
                          2973) number_of_reviews< 9.5 804 3.554122e+01 2.173251 *
                        1487) range_review>=27.5 169 6.834078e+00 2.237254 *
                  93) accommodates>=15 27 4.260050e+00 2.656604 *
                47) number_of_reviews< 0.5 1507 1.571979e+02 2.225555  
                  94) accommodates< 3.5 700 5.918285e+01 2.164592  
                   188) beds>=1.5 269 2.504388e+01 2.115344  
                     376) host_since< 22.5 91 7.441743e+00 2.014670 *
                     377) host_since>=22.5 178 1.620832e+01 2.166812 *
                   189) beds< 1.5 431 3.307935e+01 2.195329 *
                  95) accommodates>=3.5 807 9.315697e+01 2.278435  
                   190) beds>=3.5 38 6.394149e+00 1.963071 *
                   191) beds< 3.5 769 8.279682e+01 2.294018  
                     382) cleaning_fee>=0.5 443 3.318440e+01 2.232979  
                       764) accommodates< 6.5 429 2.905405e+01 2.218870 *
                       765) accommodates>=6.5 14 1.428392e+00 2.665295 *
                     383) cleaning_fee< 0.5 326 4.571897e+01 2.376964  
                       766) accommodates< 5.5 298 4.112168e+01 2.357050  
                        1532) host_since< 10.5 22 2.108812e+00 2.116510 *
                        1533) host_since>=10.5 276 3.763850e+01 2.376224  
                          3066) host_identity_verified>=0.5 127 1.589997e+01 2.286328 *
                          3067) host_identity_verified< 0.5 149 1.983745e+01 2.452846 *
                       767) accommodates>=5.5 28 3.221331e+00 2.588909 *
         3) bedrooms>=1.5 9663 7.959699e+02 2.369259  
           6) bathrooms< 2.25 8058 5.182928e+02 2.316581  
            12) bathrooms< 1.25 4377 2.370862e+02 2.243691  
              24) accommodates< 2.5 318 2.406545e+01 2.000299  
                48) bedrooms>=2.5 64 3.531260e+00 1.812385 *
                49) bedrooms< 2.5 254 1.770480e+01 2.047647  
                  98) accommodates< 1.5 29 8.324589e-01 1.860225 *
                  99) accommodates>=1.5 225 1.572236e+01 2.071804 *
              25) accommodates>=2.5 4059 1.927067e+02 2.262759  
                50) bedrooms< 2.5 3435 1.548866e+02 2.248739  
                 100) number_of_reviews>=0.5 2884 1.141177e+02 2.237323  
                   200) cancellation_policy< 2.5 1226 4.583602e+01 2.206673 *
                   201) cancellation_policy>=2.5 1658 6.627826e+01 2.259988 *
                 101) number_of_reviews< 0.5 551 3.842602e+01 2.308488  
                   202) accommodates< 3.5 52 1.507221e+00 2.138882 *
                   203) accommodates>=3.5 499 3.526706e+01 2.326163 *
                51) bedrooms>=2.5 624 3.342806e+01 2.339938  
                 102) number_of_reviews>=9.5 330 1.415369e+01 2.294505 *
                 103) number_of_reviews< 9.5 294 1.782865e+01 2.390933  
                   206) accommodates< 5.5 73 3.963536e+00 2.283023 *
                   207) accommodates>=5.5 221 1.273427e+01 2.426578 *
            13) bathrooms>=1.25 3681 2.302991e+02 2.403254  
              26) accommodates< 3.5 197 1.805885e+01 2.183385  
                52) host_since< 13.5 15 6.953344e-01 1.919132 *
                53) host_since>=13.5 182 1.622974e+01 2.205164 *
              27) accommodates>=3.5 3484 2.021783e+02 2.415686  
                54) bedrooms< 2.5 2145 1.202713e+02 2.377010  
                 108) number_of_reviews>=0.5 1700 7.575916e+01 2.348812  
                   216) host_since< 38.5 835 3.909107e+01 2.321221 *
                   217) host_since>=38.5 865 3.541882e+01 2.375446 *
                 109) number_of_reviews< 0.5 445 3.799635e+01 2.484735  
                   218) cleaning_fee>=0.5 311 2.164976e+01 2.438182 *
                   219) cleaning_fee< 0.5 134 1.410835e+01 2.592779  
                     438) accommodates< 4.5 65 6.068438e+00 2.492097 *
                     439) accommodates>=4.5 69 6.760325e+00 2.687624 *
                55) bedrooms>=2.5 1339 7.355857e+01 2.477643  
                 110) bedrooms< 3.5 1065 5.397696e+01 2.454231  
                   220) cleaning_fee>=0.5 926 3.980446e+01 2.440845 *
                   221) cleaning_fee< 0.5 139 1.290121e+01 2.543406 *
                 111) bedrooms>=3.5 274 1.672885e+01 2.568643 *
           7) bathrooms>=2.25 1605 1.430569e+02 2.633728  
            14) bathrooms< 3.25 1144 8.914131e+01 2.569606  
              28) number_of_reviews>=0.5 837 5.655908e+01 2.535790  
                56) accommodates< 5.5 172 1.562253e+01 2.399641  
                 112) cancellation_policy< 2.5 86 7.722411e+00 2.264323  
                   224) host_since< 39 41 4.285951e+00 2.127102 *
                   225) host_since>=39 45 1.961045e+00 2.389347 *
                 113) cancellation_policy>=2.5 86 4.750658e+00 2.534958 *
                57) accommodates>=5.5 665 3.692361e+01 2.571004  
                 114) bathrooms< 2.75 387 2.021870e+01 2.533671 *
                 115) bathrooms>=2.75 278 1.541465e+01 2.622975 *
              29) number_of_reviews< 0.5 307 2.901568e+01 2.661800 *
            15) bathrooms>=3.25 461 3.753919e+01 2.792851  
              30) bathrooms< 4.75 374 2.791064e+01 2.737493 *
              31) bathrooms>=4.75 87 3.555360e+00 3.030828 *
:::
:::

::: {.cell .code execution_count="65" execution="{\"iopub.execute_input\":\"2023-03-13T01:03:12.795149Z\",\"iopub.status.busy\":\"2023-03-13T01:03:12.792859Z\",\"iopub.status.idle\":\"2023-03-13T01:03:20.183590Z\"}" trusted="true"}
``` R
rpart.plot(rtree_best_model,type = 5, extra = "auto",
    under = FALSE, fallen.leaves = TRUE,
    digits = 2, varlen = 0, faclen = 0, roundint = TRUE,
    cex = NULL, tweak = 1.1,
    clip.facs = FALSE, clip.right.labs = TRUE,
    snip = FALSE,
    box.palette = c("BnGn"), shadow.col = 0)
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/7abc62fc85c800bd81871eca28981c1c641a0a43.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="29" execution="{\"iopub.execute_input\":\"2023-03-12T21:54:26.879123Z\",\"iopub.status.busy\":\"2023-03-12T21:54:26.877918Z\",\"iopub.status.idle\":\"2023-03-12T21:54:26.961814Z\"}" trusted="true"}
``` R
test.pred <- 10^(predict(rtree_best_model,newdata=data_uji))
SS.total      <- sum((data_uji$price - mean(data_uji$price))^2)
SS.residual   <- sum((data_uji$price - test.pred)^2)
SS.regression <- sum((test.pred - mean(data_uji$price)^2))
test.rsq_rtree <- 1 - SS.residual/SS.total  
test.rsq_rtree
```

::: {.output .display_data}
0.379636054858209
:::
:::

::: {.cell .markdown}
### Bagging Tree
:::

::: {.cell .code execution_count="30" execution="{\"iopub.execute_input\":\"2023-03-12T21:54:26.966397Z\",\"iopub.status.busy\":\"2023-03-12T21:54:26.965037Z\",\"iopub.status.idle\":\"2023-03-12T22:05:44.160032Z\"}" trusted="true"}
``` R
# assess 10-70 bagged trees
ntree <- 10:70

# create empty vector to store rsq values
rsquare <- vector(mode = "numeric", length = length(ntree))

for (i in seq_along(ntree)) {
  # reproducibility
  set.seed(1123)
  
  # perform bagged model
  model <- bagging(
  formula = log(price,10) ~ .,
  data    = data_latih,
  coob    = TRUE,
  nbagg   = ntree[i])
  # get rsquare
  test.pred <- 10^(predict(model,newdata=data_latih))
  SS.total      <- sum((data_latih$price - mean(data_latih$price))^2)
  SS.residual   <- sum((data_latih$price - test.pred)^2)
  SS.regression <- sum((test.pred - mean(data_latih$price)^2))
  test.rsq <- 1 - SS.residual/SS.total   
  rsquare[i] <- test.rsq
}
```
:::

::: {.cell .code execution_count="31" execution="{\"iopub.execute_input\":\"2023-03-12T22:05:44.164739Z\",\"iopub.status.busy\":\"2023-03-12T22:05:44.163391Z\",\"iopub.status.idle\":\"2023-03-12T22:05:44.234139Z\"}" trusted="true"}
``` R
plot(ntree, rsquare, type = 'l', lwd = 2)
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/d6537d1cd1e2f23c1e9ae3c7978df23c95878284.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="66" execution="{\"iopub.execute_input\":\"2023-03-13T01:05:38.205349Z\",\"iopub.status.busy\":\"2023-03-13T01:05:38.203091Z\",\"iopub.status.idle\":\"2023-03-13T01:05:38.244616Z\"}" trusted="true"}
``` R
which.max(rsquare)+10
```

::: {.output .display_data}
56
:::
:::

::: {.cell .code execution_count="32" execution="{\"iopub.execute_input\":\"2023-03-12T22:05:44.238931Z\",\"iopub.status.busy\":\"2023-03-12T22:05:44.237511Z\",\"iopub.status.idle\":\"2023-03-12T22:05:59.194624Z\"}" trusted="true"}
``` R
set.seed(132)
model <- bagging(
  formula = log(price,10) ~ .,
  data    = data_latih,
  coob    = TRUE,
  nbagg   = which.max(rsquare)+10,
  )
model
```

::: {.output .display_data}

    Bagging regression trees with 56 bootstrap replications 

    Call: bagging.data.frame(formula = log(price, 10) ~ ., data = data_latih, 
        coob = TRUE, nbagg = which.max(rsquare) + 10)

    Out-of-bag estimate of root mean squared error:  0.2423 
:::
:::

::: {.cell .code execution_count="33" execution="{\"iopub.execute_input\":\"2023-03-12T22:05:59.199157Z\",\"iopub.status.busy\":\"2023-03-12T22:05:59.197822Z\",\"iopub.status.idle\":\"2023-03-12T22:05:59.363819Z\"}" trusted="true"}
``` R
test.pred <- 10^(predict(model,newdata=data_uji))
SS.total      <- sum((data_uji$price - mean(data_uji$price))^2)
SS.residual   <- sum((data_uji$price - test.pred)^2)
SS.regression <- sum((test.pred - mean(data_uji$price)^2))
test.rsq_bagging <- 1 - SS.residual/SS.total   
test.rsq_bagging
```

::: {.output .display_data}
0.280702674448806
:::
:::

::: {.cell .markdown}
## Model Random Forest
:::

::: {.cell .code execution_count="34" execution="{\"iopub.execute_input\":\"2023-03-12T22:05:59.368006Z\",\"iopub.status.busy\":\"2023-03-12T22:05:59.366812Z\",\"iopub.status.idle\":\"2023-03-12T22:05:59.378762Z\"}" trusted="true"}
``` R
fitControl <- trainControl(
  method = "cv",
  number = 5,
  returnResamp = "all")
```
:::

::: {.cell .code execution_count="35" execution="{\"iopub.execute_input\":\"2023-03-12T22:05:59.382913Z\",\"iopub.status.busy\":\"2023-03-12T22:05:59.381723Z\",\"iopub.status.idle\":\"2023-03-13T00:02:21.150533Z\"}" trusted="true"}
``` R
set.seed(998)
rf <- train(log(price,10) ~ ., 
            data = data_latih,
            method = 'ranger',
            tuneLength = 20, 
            importance = "impurity",
            trControl = fitControl,
            verbose = FALSE)
rf
```

::: {.output .stream .stdout}
    note: only 14 unique complexity parameters in default grid. Truncating the grid to 14 .
:::

::: {.output .display_data}
    Random Forest 

    41503 samples
       15 predictor

    No pre-processing
    Resampling: Cross-Validated (5 fold) 
    Summary of sample sizes: 33204, 33202, 33201, 33203, 33202 
    Resampling results across tuning parameters:

      mtry  splitrule   RMSE       Rsquared   MAE      
       2    variance    0.2246240  0.4857803  0.1728020
       2    extratrees  0.2326470  0.4636153  0.1790011
       3    variance    0.2222043  0.4917841  0.1708440
       3    extratrees  0.2247998  0.4830601  0.1727061
       4    variance    0.2228614  0.4881034  0.1712533
       4    extratrees  0.2235910  0.4855532  0.1717625
       5    variance    0.2238994  0.4834729  0.1720154
       5    extratrees  0.2239588  0.4831321  0.1720132
       6    variance    0.2249753  0.4789101  0.1727448
       6    extratrees  0.2245688  0.4802302  0.1724327
       7    variance    0.2259939  0.4746387  0.1733695
       7    extratrees  0.2251336  0.4777568  0.1728293
       8    variance    0.2268149  0.4712745  0.1739636
       8    extratrees  0.2257172  0.4752651  0.1732419
       9    variance    0.2275974  0.4681189  0.1744539
       9    extratrees  0.2262188  0.4731717  0.1736059
      10    variance    0.2281848  0.4657621  0.1748537
      10    extratrees  0.2266398  0.4714803  0.1738627
      11    variance    0.2287327  0.4635263  0.1752568
      11    extratrees  0.2270950  0.4696083  0.1741703
      12    variance    0.2292179  0.4616042  0.1756177
      12    extratrees  0.2275056  0.4679592  0.1744656
      13    variance    0.2295628  0.4602486  0.1758708
      13    extratrees  0.2278856  0.4664255  0.1746555
      14    variance    0.2299579  0.4587262  0.1761518
      14    extratrees  0.2283211  0.4647125  0.1749621
      15    variance    0.2303153  0.4573158  0.1763682
      15    extratrees  0.2287304  0.4630299  0.1752211

    Tuning parameter 'min.node.size' was held constant at a value of 5
    RMSE was used to select the optimal model using the smallest value.
    The final values used for the model were mtry = 3, splitrule = variance
     and min.node.size = 5.
:::
:::

::: {.cell .code execution_count="36" execution="{\"iopub.execute_input\":\"2023-03-13T00:02:21.154744Z\",\"iopub.status.busy\":\"2023-03-13T00:02:21.153489Z\",\"iopub.status.idle\":\"2023-03-13T00:02:21.386719Z\"}" trusted="true"}
``` R
plot(rf, main = "5-Fold Cross Validation Random Forest: tuneLength")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/1a829d5c7e161280bfe08c5f92339c1e8df62749.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="37" execution="{\"iopub.execute_input\":\"2023-03-13T00:02:21.394910Z\",\"iopub.status.busy\":\"2023-03-13T00:02:21.391489Z\",\"iopub.status.idle\":\"2023-03-13T00:13:35.273272Z\"}" trusted="true"}
``` R
set.seed(456)
rf_best_model <- train(log(price,10) ~ ., 
            data = data_latih,
            method = 'ranger',
            tuneGrid  = rf$bestTune, 
            importance = "impurity",
            verbose = FALSE)
rf_best_model
```

::: {.output .display_data}
    Random Forest 

    41503 samples
       15 predictor

    No pre-processing
    Resampling: Bootstrapped (25 reps) 
    Summary of sample sizes: 41503, 41503, 41503, 41503, 41503, 41503, ... 
    Resampling results:

      RMSE       Rsquared   MAE      
      0.2226322  0.4886272  0.1711812

    Tuning parameter 'mtry' was held constant at a value of 3
    Tuning
     parameter 'splitrule' was held constant at a value of variance

    Tuning parameter 'min.node.size' was held constant at a value of 5
:::
:::

::: {.cell .code execution_count="38" execution="{\"iopub.execute_input\":\"2023-03-13T00:13:35.277551Z\",\"iopub.status.busy\":\"2023-03-13T00:13:35.276241Z\",\"iopub.status.idle\":\"2023-03-13T00:13:36.835684Z\"}" trusted="true"}
``` R
test.pred <- 10^(predict(rf_best_model,newdata=data_uji))
SS.total      <- sum((data_uji$price - mean(data_uji$price))^2)
SS.residual   <- sum((data_uji$price - test.pred)^2)
SS.regression <- sum((test.pred - mean(data_uji$price)^2))
test.rsq_forest <- 1 - SS.residual/SS.total   
test.rsq_forest
```

::: {.output .display_data}
0.387543506928256
:::
:::

::: {.cell .markdown}
### Gradient Boosting
:::

::: {.cell .code execution_count="39" execution="{\"iopub.execute_input\":\"2023-03-13T00:13:36.839910Z\",\"iopub.status.busy\":\"2023-03-13T00:13:36.838747Z\",\"iopub.status.idle\":\"2023-03-13T00:27:32.246053Z\"}" trusted="true"}
``` R
boost <- train(log(price,10) ~., 
               data=data_latih, 
               method="gbm",
               tuneLength = 10,  
               trControl=fitControl,
               verbose = FALSE)
boost
```

::: {.output .display_data}
    Stochastic Gradient Boosting 

    41503 samples
       15 predictor

    No pre-processing
    Resampling: Cross-Validated (5 fold) 
    Summary of sample sizes: 33203, 33203, 33203, 33202, 33201 
    Resampling results across tuning parameters:

      interaction.depth  n.trees  RMSE       Rsquared   MAE      
       1                  50      0.2411311  0.4110148  0.1847679
       1                 100      0.2356717  0.4314589  0.1807007
       1                 150      0.2336647  0.4392092  0.1791331
       1                 200      0.2324919  0.4441749  0.1783225
       1                 250      0.2318393  0.4468752  0.1778781
       1                 300      0.2313405  0.4490005  0.1775726
       1                 350      0.2309658  0.4506023  0.1773527
       1                 400      0.2307647  0.4514580  0.1772518
       1                 450      0.2305769  0.4522725  0.1771549
       1                 500      0.2304530  0.4527935  0.1770883
       2                  50      0.2343668  0.4390273  0.1796372
       2                 100      0.2301692  0.4557129  0.1765495
       2                 150      0.2281542  0.4643790  0.1753040
       2                 200      0.2270828  0.4690547  0.1745523
       2                 250      0.2264144  0.4719600  0.1740896
       2                 300      0.2258004  0.4747458  0.1736628
       2                 350      0.2253982  0.4765954  0.1733532
       2                 400      0.2249608  0.4785905  0.1730261
       2                 450      0.2246608  0.4799775  0.1727670
       2                 500      0.2243739  0.4812741  0.1725757
       3                  50      0.2306665  0.4556224  0.1769967
       3                 100      0.2268828  0.4706285  0.1743132
       3                 150      0.2253162  0.4772151  0.1732024
       3                 200      0.2245083  0.4807762  0.1725955
       3                 250      0.2239595  0.4832467  0.1722099
       3                 300      0.2235257  0.4852365  0.1718509
       3                 350      0.2231026  0.4871297  0.1715701
       3                 400      0.2229243  0.4879422  0.1714635
       3                 450      0.2227444  0.4887659  0.1713631
       3                 500      0.2226112  0.4893766  0.1712083
       4                  50      0.2291517  0.4618262  0.1759344
       4                 100      0.2254298  0.4770668  0.1733730
       4                 150      0.2239341  0.4835476  0.1722814
       4                 200      0.2232359  0.4866298  0.1717831
       4                 250      0.2227629  0.4887393  0.1714508
       4                 300      0.2225042  0.4898930  0.1712526
       4                 350      0.2223524  0.4905651  0.1711517
       4                 400      0.2221924  0.4912809  0.1709924
       4                 450      0.2220646  0.4918694  0.1708811
       4                 500      0.2220207  0.4920466  0.1708231
       5                  50      0.2276746  0.4683024  0.1750183
       5                 100      0.2243177  0.4820634  0.1725438
       5                 150      0.2232076  0.4868394  0.1716624
       5                 200      0.2225520  0.4896922  0.1711864
       5                 250      0.2222562  0.4910353  0.1709437
       5                 300      0.2220279  0.4920491  0.1707827
       5                 350      0.2219006  0.4926242  0.1706740
       5                 400      0.2218308  0.4929123  0.1706243
       5                 450      0.2217485  0.4933102  0.1705587
       5                 500      0.2217140  0.4934398  0.1705313
       6                  50      0.2266115  0.4727804  0.1742658
       6                 100      0.2237155  0.4846699  0.1721156
       6                 150      0.2228228  0.4885385  0.1713858
       6                 200      0.2223492  0.4906137  0.1710607
       6                 250      0.2220741  0.4918287  0.1708061
       6                 300      0.2219384  0.4924640  0.1706764
       6                 350      0.2218569  0.4927968  0.1706165
       6                 400      0.2218201  0.4929661  0.1705305
       6                 450      0.2218339  0.4929071  0.1705321
       6                 500      0.2218085  0.4930143  0.1704924
       7                  50      0.2256773  0.4768660  0.1736657
       7                 100      0.2230456  0.4876484  0.1716893
       7                 150      0.2221965  0.4913626  0.1709950
       7                 200      0.2217815  0.4932391  0.1706985
       7                 250      0.2215486  0.4942429  0.1705025
       7                 300      0.2214404  0.4947174  0.1703835
       7                 350      0.2214340  0.4947481  0.1703745
       7                 400      0.2214983  0.4944403  0.1704100
       7                 450      0.2215282  0.4943206  0.1704164
       7                 500      0.2215750  0.4940974  0.1704516
       8                  50      0.2253093  0.4783811  0.1733698
       8                 100      0.2227864  0.4888235  0.1714970
       8                 150      0.2220085  0.4922019  0.1708430
       8                 200      0.2217355  0.4933865  0.1706284
       8                 250      0.2216003  0.4940000  0.1705690
       8                 300      0.2214622  0.4946128  0.1704724
       8                 350      0.2213577  0.4950973  0.1704098
       8                 400      0.2213324  0.4952310  0.1704205
       8                 450      0.2213420  0.4951570  0.1704225
       8                 500      0.2213717  0.4950463  0.1704022
       9                  50      0.2248289  0.4803826  0.1730436
       9                 100      0.2227105  0.4890443  0.1713944
       9                 150      0.2221067  0.4916900  0.1709951
       9                 200      0.2217882  0.4931124  0.1707015
       9                 250      0.2217036  0.4935131  0.1706473
       9                 300      0.2216660  0.4936735  0.1706191
       9                 350      0.2216830  0.4936068  0.1705914
       9                 400      0.2216815  0.4936572  0.1705851
       9                 450      0.2217467  0.4933720  0.1706279
       9                 500      0.2218068  0.4930943  0.1706840
      10                  50      0.2245928  0.4814708  0.1727999
      10                 100      0.2225017  0.4900067  0.1711951
      10                 150      0.2220290  0.4920716  0.1708009
      10                 200      0.2217610  0.4932699  0.1706004
      10                 250      0.2216017  0.4939765  0.1704719
      10                 300      0.2215067  0.4944134  0.1703863
      10                 350      0.2215325  0.4943192  0.1704046
      10                 400      0.2216038  0.4940067  0.1704121
      10                 450      0.2216821  0.4936919  0.1704718
      10                 500      0.2217194  0.4935409  0.1704843

    Tuning parameter 'shrinkage' was held constant at a value of 0.1

    Tuning parameter 'n.minobsinnode' was held constant at a value of 10
    RMSE was used to select the optimal model using the smallest value.
    The final values used for the model were n.trees = 400, interaction.depth =
     8, shrinkage = 0.1 and n.minobsinnode = 10.
:::
:::

::: {.cell .code execution_count="40" execution="{\"iopub.execute_input\":\"2023-03-13T00:27:32.250323Z\",\"iopub.status.busy\":\"2023-03-13T00:27:32.249089Z\",\"iopub.status.idle\":\"2023-03-13T00:27:32.436948Z\"}" trusted="true"}
``` R
plot(boost, main = "5-Fold Cross Validation Gradient Boosting: tuneLength")
```

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/fc8d4ebee06197ed500d70e0d9324e621825a284.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="41" execution="{\"iopub.execute_input\":\"2023-03-13T00:27:32.442150Z\",\"iopub.status.busy\":\"2023-03-13T00:27:32.440224Z\",\"iopub.status.idle\":\"2023-03-13T00:37:13.366961Z\"}" trusted="true"}
``` R
boost_best_model <- train(log(price,10) ~., 
               data=data_latih, 
               method="gbm",
               tuneGrid  = boost$bestTune,
               verbose = FALSE)
boost_best_model
```

::: {.output .display_data}
    Stochastic Gradient Boosting 

    41503 samples
       15 predictor

    No pre-processing
    Resampling: Bootstrapped (25 reps) 
    Summary of sample sizes: 41503, 41503, 41503, 41503, 41503, 41503, ... 
    Resampling results:

      RMSE       Rsquared   MAE      
      0.2223232  0.4904503  0.1707546

    Tuning parameter 'n.trees' was held constant at a value of 400
    Tuning

    Tuning parameter 'shrinkage' was held constant at a value of 0.1

    Tuning parameter 'n.minobsinnode' was held constant at a value of 10
:::
:::

::: {.cell .code execution_count="70" execution="{\"iopub.execute_input\":\"2023-03-13T01:14:51.176645Z\",\"iopub.status.busy\":\"2023-03-13T01:14:51.174324Z\",\"iopub.status.idle\":\"2023-03-13T01:14:51.540614Z\"}" trusted="true"}
``` R
library(gbm)
plot(varImp(boost_best_model),
     main = "Gradient Boosting Variable Importance" )
```

::: {.output .stream .stderr}
    Loaded gbm 2.1.8.1
:::

::: {.output .display_data}
![](vertopal_176b7a16c12941c2a7cd70bee0c44b07/268ee942895f464c3d05e50220d2ef58f112c236.png){height="420"
width="420"}
:::
:::

::: {.cell .code execution_count="42" execution="{\"iopub.execute_input\":\"2023-03-13T00:37:13.371171Z\",\"iopub.status.busy\":\"2023-03-13T00:37:13.369978Z\",\"iopub.status.idle\":\"2023-03-13T00:37:13.527203Z\"}" trusted="true"}
``` R
test.pred <- 10^(predict(boost_best_model,newdata=data_uji))
SS.total      <- sum((data_uji$price - mean(data_uji$price))^2)
SS.residual   <- sum((data_uji$price - test.pred)^2)
SS.regression <- sum((test.pred - mean(data_uji$price)^2))
test.rsq_grad <- 1 - SS.residual/SS.total   
test.rsq_grad
```

::: {.output .display_data}
0.404869433252209
:::
:::

::: {.cell .markdown}
## Hasil Modelling
:::

::: {.cell .code execution_count="43" execution="{\"iopub.execute_input\":\"2023-03-13T00:37:13.531416Z\",\"iopub.status.busy\":\"2023-03-13T00:37:13.530199Z\",\"iopub.status.idle\":\"2023-03-13T00:37:13.554758Z\"}" trusted="true"}
``` R
nama_model<-c("Linear","Ridge","LASSO","Elastic Net",
              "Regression Tree","Bagging",
              "Random Forest","Gradient Boosting")
rsq_model<-c(rangkuman1$rsq,test.rsq_rtree,test.rsq_bagging,test.rsq_forest,test.rsq_grad)
hasil<-data.frame(model=nama_model,rsq=rsq_model)
hasil
```

::: {.output .display_data}

A data.frame: 8 × 2

| model &lt;chr&gt; | rsq &lt;dbl&gt; |
|---|---|
| Linear            | 0.2036839 |
| Ridge             | 0.2421583 |
| LASSO             | 0.2157233 |
| Elastic Net       | 0.2222098 |
| Regression Tree   | 0.3796361 |
| Bagging           | 0.2807027 |
| Random Forest     | 0.3875435 |
| Gradient Boosting | 0.4048694 |
:::
:::

::: {.cell .markdown}
Berdasarkan hasil dari delapan pemodelan didapatkan hasil terbaik adalah
Gradien Boosting dengan hyperparameter yaitu ntrees = 400 dan max.depth
= 8 dengan R-Squared sebesar 0,4048694 pada data validasi.

Setelah itu model terbaik akan dilakukan prediksi pada data uji.
:::

::: {.cell .markdown}
## Predict
:::

::: {.cell .code execution_count="44" execution="{\"iopub.execute_input\":\"2023-03-13T00:37:13.558983Z\",\"iopub.status.busy\":\"2023-03-13T00:37:13.557739Z\",\"iopub.status.idle\":\"2023-03-13T00:37:13.910129Z\"}" trusted="true"}
``` R
submission<-read.csv("/kaggle/input/sta1582-sesi-uts-genap-2023/sample submission.csv")
submission$price<-10^(predict(boost_best_model,newdata=data_test))
head(submission)
```

::: {.output .display_data}

A data.frame: 6 × 2

| <!--/--> | id &lt;int&gt; | price &lt;dbl&gt; |
|---|---|---|
| 1 |  344 | 238.9679 |
| 2 | 2864 | 211.5777 |
| 3 | 3152 | 215.3933 |
| 4 | 3670 | 136.2497 |
| 5 | 3686 | 133.5609 |
| 6 | 3771 | 186.9872 |
:::
:::

::: {.cell .code execution_count="45" execution="{\"iopub.execute_input\":\"2023-03-13T00:37:13.914280Z\",\"iopub.status.busy\":\"2023-03-13T00:37:13.913102Z\",\"iopub.status.idle\":\"2023-03-13T00:37:13.924296Z\"}" trusted="true"}
``` R
#write.csv(submission,"/kaggle/working/sample submission.csv",row.names=F)
```
:::

::: {.cell .code execution_count="71" execution="{\"iopub.execute_input\":\"2023-03-13T01:43:37.797487Z\",\"iopub.status.busy\":\"2023-03-13T01:43:37.792854Z\",\"iopub.status.idle\":\"2023-03-13T01:43:40.240972Z\"}" trusted="true"}
``` R
data<-read.csv("/kaggle/input/sta1582-sesi-uts-genap-2023/train.csv")
str(data)
```

::: {.output .stream .stdout}
    'data.frame':	51879 obs. of  29 variables:
     $ id                    : int  6901257 6304928 7919400 13418779 3808709 12422935 11825529 13971273 180792 5385260 ...
     $ property_type         : chr  "Apartment" "Apartment" "Apartment" "House" ...
     $ room_type             : chr  "Entire home/apt" "Entire home/apt" "Entire home/apt" "Entire home/apt" ...
     $ amenities             : chr  "{\"Wireless Internet\",\"Air conditioning\",Kitchen,Heating,\"Family/kid friendly\",Essentials,\"Hair dryer\",I"| __truncated__ "{\"Wireless Internet\",\"Air conditioning\",Kitchen,Heating,\"Family/kid friendly\",Washer,Dryer,\"Smoke detect"| __truncated__ "{TV,\"Cable TV\",\"Wireless Internet\",\"Air conditioning\",Kitchen,Breakfast,\"Buzzer/wireless intercom\",Heat"| __truncated__ "{TV,\"Cable TV\",Internet,\"Wireless Internet\",Kitchen,\"Indoor fireplace\",\"Buzzer/wireless intercom\",Heati"| __truncated__ ...
     $ accommodates          : int  3 7 5 4 2 2 3 2 2 2 ...
     $ bathrooms             : num  1 1 1 1 1 1 1 1 1 1 ...
     $ bed_type              : chr  "Real Bed" "Real Bed" "Real Bed" "Real Bed" ...
     $ cancellation_policy   : chr  "strict" "strict" "moderate" "flexible" ...
     $ cleaning_fee          : chr  "True" "True" "True" "True" ...
     $ city                  : chr  "NYC" "NYC" "NYC" "SF" ...
     $ description           : chr  "Beautiful, sunlit brownstone 1-bedroom in the loveliest neighborhood in Brooklyn. Blocks from the promenade and"| __truncated__ "Enjoy travelling during your stay in Manhattan. My place is centrally located near Times Square and Central Par"| __truncated__ "The Oasis comes complete with a full backyard with outdoor furniture to make the most of this summer vacation!!"| __truncated__ "This light-filled home-away-from-home is super clean and comes with all of the modern amenities travelers could"| __truncated__ ...
     $ first_review          : chr  "2016-06-18" "2017-08-05" "2017-04-30" "" ...
     $ host_has_profile_pic  : chr  "t" "t" "t" "t" ...
     $ host_identity_verified: chr  "t" "f" "t" "t" ...
     $ host_response_rate    : chr  "" "100%" "100%" "" ...
     $ host_since            : chr  "2012-03-26" "2017-06-19" "2016-10-25" "2015-04-19" ...
     $ instant_bookable      : chr  "f" "t" "t" "f" ...
     $ last_review           : chr  "2016-07-18" "2017-09-23" "2017-09-14" "" ...
     $ latitude              : num  40.7 40.8 40.8 37.8 38.9 ...
     $ longitude             : num  -74 -74 -73.9 -122.4 -77 ...
     $ name                  : chr  "Beautiful brownstone 1-bedroom" "Superb 3BR Apt Located Near Times Square" "The Garden Oasis" "Beautiful Flat in the Heart of SF!" ...
     $ neighbourhood         : chr  "Brooklyn Heights" "Hell's Kitchen" "Harlem" "Lower Haight" ...
     $ number_of_reviews     : int  2 6 10 0 4 3 15 9 159 2 ...
     $ review_scores_rating  : int  100 93 92 NA 40 100 97 93 99 90 ...
     $ thumbnail_url         : chr  "https://a0.muscache.com/im/pictures/6d7cbbf7-c034-459c-bc82-6522c957627c.jpg?aki_policy=small" "https://a0.muscache.com/im/pictures/348a55fe-4b65-452a-b48a-bfecb3b58a66.jpg?aki_policy=small" "https://a0.muscache.com/im/pictures/6fae5362-9e3a-4fa9-aa54-bbd5ea26538d.jpg?aki_policy=small" "https://a0.muscache.com/im/pictures/72208dad-9c86-41ea-a735-43d933111063.jpg?aki_policy=small" ...
     $ zipcode               : chr  "11201" "10019" "10027" "94117.0" ...
     $ bedrooms              : int  1 3 1 2 0 1 1 1 1 1 ...
     $ beds                  : int  1 3 3 2 1 1 1 1 1 1 ...
     $ price                 : num  150 169 145 750 115 ...
:::
:::
